{% extends "base.html" %}

{% block title %}Delete Question{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-8 mt-10">
  <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
    üóëÔ∏è Delete Question
  </h2>

  <form method="POST" class="space-y-5">
    <!-- CSRF (if using Flask-WTF) -->
    {% if form and form.csrf_token %}
      {{ form.csrf_token }}
    {% endif %}

    <!-- Publication -->
    <div>
      <label for="publication" class="block text-sm font-medium text-gray-700 mb-1">Publication</label>
      <select name="publication" id="publication" onchange="loadSubjects()" required
        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="" disabled selected>--Select Publication--</option>
        {% for pub in publications %}
          <option value="{{ pub }}">{{ pub }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Subject -->
    <div>
      <label for="subject" class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
      <select name="subject" id="subject" onchange="loadClasses()" required
        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="" disabled selected>--Select Subject--</option>
      </select>
    </div>

    <!-- Class -->
    <div>
      <label for="class" class="block text-sm font-medium text-gray-700 mb-1">Class</label>
      <select name="class_name" id="class" onchange="loadChapters()" required
        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="" disabled selected>--Select Class--</option>
      </select>
    </div>

    <!-- Chapter -->
    <div>
      <label for="chapter" class="block text-sm font-medium text-gray-700 mb-1">Chapter</label>
      <select name="chapter" id="chapter" onchange="loadQtypes()" required
        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="" disabled selected>--Select Chapter--</option>
      </select>
    </div>

    <!-- Question Type -->
    <div>
      <label for="qtype" class="block text-sm font-medium text-gray-700 mb-1">Question Type</label>
      <select name="qtype" id="qtype" onchange="loadQuestions()" required
        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="" disabled selected>--Select Question Type--</option>
      </select>
    </div>

    <!-- Question -->
    <div>
      <label for="old_question" class="block text-sm font-medium text-gray-700 mb-1">Question</label>
      <select name="old_question" id="old_question" required
        class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="" disabled selected>--Select Question--</option>
      </select>
    </div>

    <!-- Submit Button -->
    <div class="pt-4">
      <button type="submit"
        onclick="return confirm('Are you sure you want to delete this question?')"
        class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2.5 rounded-xl shadow-md transition-all duration-200">
        Delete Question
      </button>
    </div>
  </form>
</div>

<!-- Flask JSON block -->
<script>
  const jsonData = {{ data | tojson | safe }};

  function loadSubjects(){
      let pub = document.getElementById("publication").value;
      let subjects = pub ? Object.keys(jsonData[pub]) : [];
      let html = '<option value="" disabled selected>--Select Subject--</option>';
      subjects.forEach(s => html += `<option value="${s}">${s}</option>`);
      document.getElementById("subject").innerHTML = html;
  }

  function loadClasses(){
      let pub = document.getElementById("publication").value;
      let sub = document.getElementById("subject").value;
      let classes = (pub && sub) ? Object.keys(jsonData[pub][sub]) : [];
      let html = '<option value="" disabled selected>--Select Class--</option>';
      classes.forEach(c => html += `<option value="${c}">${c}</option>`);
      document.getElementById("class").innerHTML = html;
  }

  function loadChapters(){
      let pub = document.getElementById("publication").value;
      let sub = document.getElementById("subject").value;
      let cls = document.getElementById("class").value;
      let chapters = (pub && sub && cls) ? Object.keys(jsonData[pub][sub][cls]) : [];
      let html = '<option value="" disabled selected>--Select Chapter--</option>';
      chapters.forEach(ch => html += `<option value="${ch}">${ch}</option>`);
      document.getElementById("chapter").innerHTML = html;
  }

  function loadQtypes(){
      let pub = document.getElementById("publication").value;
      let sub = document.getElementById("subject").value;
      let cls = document.getElementById("class").value;
      let ch = document.getElementById("chapter").value;
      let qtypes = (pub && sub && cls && ch) ? Object.keys(jsonData[pub][sub][cls][ch]) : [];
      let html = '<option value="" disabled selected>--Select Question Type--</option>';
      qtypes.forEach(qt => html += `<option value="${qt}">${qt}</option>`);
      document.getElementById("qtype").innerHTML = html;
  }

  function loadQuestions(){
      let pub = document.getElementById("publication").value;
      let sub = document.getElementById("subject").value;
      let cls = document.getElementById("class").value;
      let ch = document.getElementById("chapter").value;
      let qt = document.getElementById("qtype").value;
      let questions = (pub && sub && cls && ch && qt) ? jsonData[pub][sub][cls][ch][qt] : [];
      let html = '<option value="" disabled selected>--Select Question--</option>';

      if(qt === "Match the Following"){
          questions.forEach(pair => {
              let left = Object.keys(pair)[0];
              let right = pair[left];
              html += `<option value="${left}">${left} = ${right}</option>`;
          });
      }
      else if(qt === "Choose the Best Answer"){
          questions.forEach(mcq => {
              html += `<option value="${mcq.question}">${mcq.question}</option>`;
          });
      }
      else {
          questions.forEach(q => html += `<option value="${q}">${q}</option>`);
      }
      document.getElementById("old_question").innerHTML = html;
  }
</script>
{% endblock %}
